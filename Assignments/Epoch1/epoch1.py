#!/usr/bin/python3

from Epoch1.analysis_tools.analysis_formatting.mitre_analysis import MitreTactic, Impact, Persistence, Defense, Discovery, Execution, C2
from Epoch1.analysis_tools.analysis_formatting.formatting_classes import IOC_types, Malware_types, IOC, BinAnalysis, EpochAssignment

epoch1 = EpochAssignment("epoch1")

# FLAGS ------------------------------------------------------------------------
# in sus_exe string dump
epoch1.found_flag("FLAG{TodaysQuizWhyIsNotepadDoingNetworkIO}") 

# SUSPICIOUS.EPOCH1.EXE --------------------------------------------------------
sus_exe = BinAnalysis("suspicous.epoch1.exe")
sus_exe.set_arch(64)
sus_exe.set_comp_time("65d41e4e")
# no matches on virus total
sus_exe.set_sha256("4a548f161dfbda599686c15c56bd81eab176668cfab00bc31df31fe2032e8343") 
sus_exe.set_imphash("8ff386ea4029e407f75e80606cb72508")

sus_exe_imports = {
    "KERNEL32.dll": [
        "CloseHandle",
        "CreateProcessW",
        "CreateRemoteThread",
        "FreeConsole",
        "FreeLibrary",
        "GetFileAttributesA",
        "GetModuleHandleA",
        "GetProcAddress",
        "GetStartupInfoA",
        "GetTempPathW",
        "LoadLibraryW",
        "Sleep",
        "TlsGetValue",
        "VirtualAllocEx",
        "VirtualFreeEx",
        "VirtualProtect",
        "VirtualQuery",
        "WriteProcessMemory"
    ],
    "PSAPI.DLL": [
        "EnumProcessModules",
        "GetModuleFileNameExW"
    ],
    "SHLWAPI.dll": [
        "PathCombineW"
    ],
    "WININET.dll": [
        "DeleteUrlCacheEntryW"
    ],
    "urlmon.dll": [
        "URLDownloadToFileW",
        "UrlMkSetSessionOption"
    ]
}
sus_exe.set_sus_imports(sus_exe_imports)

sus_exe_strs = [
    "!This program cannot be run in DOS mode. $",
    "ExamMonitor.dll",
    "https://exam.gradescopech0nky.com/StartExam",
    "StartExam",
    "FLAG{TodaysQuizWhyIsNotepadDoingNetworkIO}",
    "C:\\malware\\ch0nky.txt",
    "kernel32",
    "LoadLibraryW"
]
sus_exe.set_sus_strings(sus_exe_strs)




