#!/usr/bin/python3

import json
import pefile
import sys

file_name = sys.argv[1]

pe = pefile.PE(file_name)
print(pe.get_imphash())

pe_import_dict = {}
# walk the Imports
for entry in pe.DIRECTORY_ENTRY_IMPORT:
    dll_name = entry.dll.decode('utf-8')
    pe_import_dict[dll_name] = []
    for func in entry.imports:
        pe_import_dict[dll_name] += [func.name.decode('utf-8')]

		
print(json.dumps(pe_import_dict, indent=4, sort_keys=True))

f = open(f'{file_name}_import_dict.json', 'w')
f.write(json.dumps(pe_import_dict, indent=4, sort_keys=True))
f.close()