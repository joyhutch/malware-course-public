#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/stat.h>  // For mkdir
#include <unistd.h>    // For rmdir

#define KEY "C:\\malware\\ch0nky.txt"
#define DIR "C:\\malware"

int activate(){

    if (mkdir(DIR, S_IRUSR | S_IWUSR | S_IXUSR) == -1) {
        perror("Error creating directory");
        return 1;
    }

   FILE *file;
   file = fopen(KEY, "w+");
    if (file == NULL) {
        perror("Error opening file");
        return 1;
    }

    fprintf(file, "This is testing for fprintf...\n");
    fclose(file);
    printf("Wrote file!\n");
}

int deactivate(){
    if (remove(KEY) != 0) {
            perror("Error deleting file");
            return 1;
        }
        
    printf("Deleted file!\n");
    
    if (rmdir(DIR) != 0) {
        perror("Error removing directory");
        return 1;
    }

    printf("File and directory deleted successfully.\n");
}

void usage(char* argv_0){
    printf("Usage: %s <activate|deactivate>",argv_0 );
}

int main(int argc, char* argv[]){
    if (argc != 2){
        usage(argv[0]);
        return 0;
    }

    if (strcmp( argv[1], "activate") == 0){
        activate();

    } else if(strcmp( argv[1], "deactivate") == 0){
        deactivate();
        
    } else{
        usage(argv[0]);
    }

    return 0;
}