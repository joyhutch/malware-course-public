#include <stdio.h>
#include <windows.h>

#define BUF_SIZE 256
#define SHARED_MEM_NAME "Local\\MySharedMemory"

int main() {
  HANDLE hMapFile;
  LPCTSTR pBuf;

  // Create a file mapping object
  hMapFile =
      CreateFileMapping(INVALID_HANDLE_VALUE, // Use the paging file
                        NULL,                 // Default security
                        PAGE_READWRITE,       // Read/write access
                        0,        // Maximum object size (high-order DWORD)
                        BUF_SIZE, // Maximum object size (low-order DWORD)
                        SHARED_MEM_NAME); // Name of the file mapping object

  if (hMapFile == NULL) {
    printf("Could not create file mapping object (%d).\n", GetLastError());
    return 1;
  }

  // Map the view of the file mapping into the address space
  pBuf = (LPTSTR)MapViewOfFile(hMapFile,            // Handle to map object
                               FILE_MAP_ALL_ACCESS, // Read/write permission
                               0, 0, BUF_SIZE);

  if (pBuf == NULL) {
    printf("Could not map view of file (%d).\n", GetLastError());
    CloseHandle(hMapFile);
    return 1;
  }

  // Writing data to shared memory
  printf("Writing to shared memory: \"Hello from writer process!\"\n");
  CopyMemory((PVOID)pBuf, "Hello from writer process!",
             sizeof("Hello from writer process!"));

  // Wait for the reader process to read from shared memory
  printf("Press Enter after reader process has finished reading...\n");
  getchar();

  // Unmap the shared memory
  UnmapViewOfFile(pBuf);

  // Close the file mapping object
  CloseHandle(hMapFile);

  return 0;
}
