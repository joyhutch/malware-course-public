#include <psapi.h>
#include <stdio.h>
#include <windows.h>

int main(int argc, char *argv[]) {
  if (argc != 2) {
    printf("Usage: ./%s <pid>\n", argv[0]);
    return 0;
  }
  int pid = atoi(argv[1]);
  HANDLE hProcess = NULL;
  if (pid == 0) {
    hProcess = GetCurrentProcess();
    pid = GetProcessId(hProcess);
    printf("Current PID=%d\n", pid);
  } else {
    hProcess = OpenProcess(
        PROCESS_QUERY_INFORMATION | PROCESS_VM_READ |
            PROCESS_TERMINATE, // If we want to Query basic information, we need
                               // these access rights
        FALSE, // We don't need child processes to inherit this handle
        pid    // Processes Identifier (PID)
    );
  }
  if (!hProcess) {
    printf("Failed to open Processes %d because of %d\n", pid, GetLastError());
    return 0;
  } else {
    printf("Attempting to terminate pid=%d\n", pid);
  }

  if (!TerminateProcess(hProcess, 0)) {
    printf("Failed to terminate %d because of %d\n", GetLastError());
  } else {
    printf("Terminnated %d\n", pid);
  }

  if (hProcess) {
    CloseHandle(hProcess);
  }
  return 0;
}
