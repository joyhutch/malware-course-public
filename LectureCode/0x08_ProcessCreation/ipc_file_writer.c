#include <stdio.h>
#include <windows.h>

int main(void) {
  HANDLE hFile;
  DWORD dwBytesToWrite = (DWORD)strlen("Hello from Process 1!");
  DWORD dwBytesWritten = 0;
  BOOL bErrorFlag = FALSE;

  // Create a new file or open if it already exists
  hFile = CreateFileA("example_ipc_file.txt", // File name
                      GENERIC_WRITE,          // Open for writing
                      0,                      // Do not share
                      NULL,                   // Default security
                      CREATE_ALWAYS,          // Creates a new file, always
                      FILE_ATTRIBUTE_NORMAL,  // Normal file
                      NULL);                  // No attribute template

  if (hFile == INVALID_HANDLE_VALUE) {
    printf("CreateFile failed with %d\n", GetLastError());
    return 1;
  }

  // Write to the file
  bErrorFlag = WriteFile(hFile,                   // Open file handle
                         "Hello from Process 1!", // Data to write
                         dwBytesToWrite,          // Number of bytes to write
                         &dwBytesWritten, // Number of bytes that were written
                         NULL);           // No overlapping

  if (FALSE == bErrorFlag) {
    printf("WriteFile failed with %d\n", GetLastError());
  } else {
    if (dwBytesWritten != dwBytesToWrite) {
      // This is an error because it did not write all the data
      printf("Error: dwBytesWritten != dwBytesToWrite\n");
    } else {
      printf("Wrote %d bytes to %s successfully.\n", dwBytesWritten,
             "example_ipc_file.txt");
    }
  }

  // Close the file handle
  CloseHandle(hFile);

  return 0;
}
