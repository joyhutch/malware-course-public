#include <stdio.h>
#include <windows.h>

#define BUF_SIZE 256
#define SHARED_MEM_NAME "Local\\MySharedMemory"

int main() {
  HANDLE hMapFile;
  LPCTSTR pBuf;

  // Open the file mapping object
  hMapFile =
      OpenFileMapping(FILE_MAP_ALL_ACCESS, // Read/write access
                      FALSE,               // Do not inherit the name
                      SHARED_MEM_NAME);    // Name of the file mapping object

  if (hMapFile == NULL) {
    printf("Could not open file mapping object (%d).\n", GetLastError());
    return 1;
  }

  // Map the view of the file mapping into the address space
  pBuf = (LPTSTR)MapViewOfFile(hMapFile,            // Handle to map object
                               FILE_MAP_ALL_ACCESS, // Read/write permission
                               0, 0, BUF_SIZE);

  if (pBuf == NULL) {
    printf("Could not map view of file (%d).\n", GetLastError());
    CloseHandle(hMapFile);
    return 1;
  }

  // Reading data from shared memory
  printf("Message read from shared memory: \"%s\"\n", pBuf);

  // Unmap the shared memory
  UnmapViewOfFile(pBuf);

  // Close the file mapping object
  CloseHandle(hMapFile);

  return 0;
}
