#include <stdio.h>
#include <windows.h>

int main(void) {
  HANDLE hFile;
  DWORD dwBytesRead = 0;
  char ReadBuffer[1024] = {0};

  // Open the existing file for reading
  hFile = CreateFileA("example_ipc_file.txt", // File name
                      GENERIC_READ,           // Open for reading
                      FILE_SHARE_READ,        // Share for reading
                      NULL,                   // Default security
                      OPEN_EXISTING,          // Opens existing file
                      FILE_ATTRIBUTE_NORMAL,  // Normal file
                      NULL);                  // No attribute template

  if (hFile == INVALID_HANDLE_VALUE) {
    printf("CreateFile failed with %d\n", GetLastError());
    return 1;
  }

  // Read from the file
  if (FALSE ==
      ReadFile(hFile, ReadBuffer, sizeof(ReadBuffer) - 1, &dwBytesRead, NULL)) {
    printf("ReadFile failed with %d\n", GetLastError());
  } else {
    printf("Data read from %s: %s\n", "example_ipc_file.txt", ReadBuffer);
  }

  // Close the file handle before deleting the file
  CloseHandle(hFile);

  // Delete the file after it has been read
  if (FALSE == DeleteFileA("example_ipc_file.txt")) {
    printf("DeleteFile failed with %d\n", GetLastError());
  } else {
    printf("File successfully deleted.\n");
  }

  return 0;
}
