#include <stdio.h>
#include <windows.h>

int main(void) {
  HANDLE hPipe;
  DWORD dwWritten, dwRead;
  char buffer[1024];

  hPipe = CreateFileA("\\\\.\\pipe\\MyPipe", GENERIC_READ | GENERIC_WRITE, 0,
                      NULL, OPEN_EXISTING, 0, NULL);

  if (hPipe != INVALID_HANDLE_VALUE) {
    char *message = "Hello from client!";
    WriteFile(hPipe, message, strlen(message), &dwWritten, NULL);

    // Read server response.
    ReadFile(hPipe, buffer, sizeof(buffer) - 1, &dwRead, NULL);
    buffer[dwRead] = '\0';
    printf("Received: %s\n", buffer);

    CloseHandle(hPipe);
  } else {
    fprintf(stderr, "Failed to connect to pipe. GLE=%d\n", GetLastError());
  }

  return 0;
}
