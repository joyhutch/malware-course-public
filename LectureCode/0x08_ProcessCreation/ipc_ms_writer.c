#include <stdio.h>
#include <windows.h>

int main(void) {
  HANDLE hFile;
  BOOL writeResult;
  DWORD bytesWritten;
  char message[] = "Hello, Mailslot!";

  // Open the mailslot with the name "\\.\mailslot\sample_mailslot".
  hFile = CreateFile(TEXT("\\\\.\\mailslot\\sample_mailslot"), GENERIC_WRITE,
                     FILE_SHARE_READ, NULL, OPEN_EXISTING,
                     FILE_ATTRIBUTE_NORMAL, NULL);

  if (hFile == INVALID_HANDLE_VALUE) {
    printf("CreateFile failed with %d\n", GetLastError());
    return 1;
  }

  // Write a message to the mailslot.
  writeResult = WriteFile(hFile, message, sizeof(message), &bytesWritten, NULL);

  if (!writeResult) {
    printf("WriteFile failed with %d\n", GetLastError());
  } else {
    printf("Message \"%s\" sent to the mailslot.\n", message);
  }

  CloseHandle(hFile);
  return 0;
}
